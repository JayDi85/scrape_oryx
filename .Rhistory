# Setup
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
library(tidyr)
#' @title scrape_oryx
#' @description A simple R script for extracting tabular data from Oryx' excellent
#'   post detailing materiel lost by all sides in the [Russian invasion of
#'   Ukraine](https://www.oryxspioenkop.com/2022/02/attack-on-europe-documenting-equipment.html).
#'
#'
#' @author Daniel Scarnecchia
#'
# Setup
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
source("R/functions.R")
tmp <- file.path("outputfiles", sprintf("scrape_oryx_%s.log", format(Sys.time(), "%Y%m%dT%H%M%S")))
lf <- log_open(tmp)
today <- format(Sys.Date(), "%Y-%m-%d")
oryx <- rvest::read_html(
"https://www.oryxspioenkop.com/2022/02/attack-on-europe-documenting-equipment.html"
) %>% rvest::html_elements("article")
materiel <- oryx %>% rvest::html_elements("li")
# Retreive the start position of each country
country_pos <- materiel %>% rvest::html_text2() %>%
# T-64BV is the first row in the tank list and marks the beginning of each country
stringr::str_which("T-64BV")
#' Run Program
data <-
tibble::tibble(
country = character(),
origin = character(),
system = character(),
status = character(),
url = character(),
)
counter = 0
for (a in seq_along(materiel)) {
status <- materiel[[a]] %>% rvest::html_elements("a")
for (b in seq_along(status)) {
counter = counter + 1
data[counter, 1] <- ifelse(a < country_pos[2], "Russia", "Ukraine")
data[counter, 2] <- extract_origin(materiel, a)
data[counter, 3] <- extract_system(materiel, a)
data[counter, 4] <- extract_status(status, b)
data[counter, 5] <- extract_url(status, b)
}
}
readr::write_csv(data, file=glue::glue("outputfiles/data_{today}.csv"))
data_wide <- data %>%
dplyr::select(country, system, status) %>%
dplyr::group_by(country, system, status) %>%
dplyr::summarise(count = n())
readr::write_csv(data_wide, file=glue::glue("outputfiles/data_wide_{today}.csv"))
logr::log_code()
logr::log_close()
writeLines(readLines(lf))
renv::restore()
renv::snapshot()
renv::install("rmarkdown")
renv::install("knitr")
renv::restore()
proj_get()
usethis::proj_get
usethis::proj_get()
use_this::proj_get()
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
source("R/functions.R")
source("R/scrape_data.R")
source("R/totals_by_type.R")
source("R/per_event.R")
totals_by_type() %>% dplyr::filter(country=="Russia")
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
renv::install("kableExtra")
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
library(kableExtra)
source("R/functions.R")
source("R/scrape_data.R")
source("R/totals_by_type.R")
source("R/per_event.R")
total_by_system_wide(totals_by_system) %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
totals_by_system <- scrape_data() %>%
readr::write_csv(., file = glue::glue("outputfiles/totals_by_system_{today}.csv"))
totals_by_system <- scrape_data()
total_by_system_wide(totals_by_system) %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
library(kableExtra)
source("R/functions.R")
source("R/scrape_data.R")
source("R/totals_by_type.R")
source("R/per_event.R")
totals_by_system <- scrape_data()
total_by_system_wide(totals_by_system) %>% dplyr::filter(country=="Russia") dplyr::arrange(country, total) %>% kableExtra::kbl(caption="Russia: Totals by System and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
total_by_system_wide(totals_by_system) %>% dplyr::filter(country=="Russia") %>% dplyr::arrange(country, total) %>% kableExtra::kbl(caption="Russia: Totals by System and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
?dplyr::arrange
total_by_system_wide(totals_by_system) %>% dplyr::filter(country=="Russia") %>% dplyr::arrange(desc(total)) %>% kableExtra::kbl(caption="Russia: Totals by System and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic(full_width = F, html_font = "Cambria")
install.packages("tint")
?tint::tintHtml
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
library(kableExtra)
library(tint)
source("R/functions.R")
source("R/scrape_data.R")
source("R/totals_by_type.R")
source("R/per_event.R")
totals_by_system <- scrape_data()
totals_by_type() %>% dplyr::filter(country=="Russia") %>% knitr::kable(caption="Russia: Totals by System Type and Status")
rmarkdown::tufte_handout()
renv::install("tufte")
library(renv)
library(rvest)
library(dplyr)
library(tidyr)
library(lubridate)
library(purrr)
library(magrittr)
library(tibble)
library(stringr)
library(readr)
library(glue)
library(logr)
library(kableExtra)
library(tufte)
source("R/functions.R")
source("R/scrape_data.R")
source("R/totals_by_type.R")
source("R/per_event.R")
totals_by_system <- scrape_data()
tufte::margin_note("Due to how the data is recorded, weapons systems may be recorded in here twiceâ€”*e.g.*, if it is listed as abandoned and captured, a system will be counted in both the abandoned and captured tallies.")
?tufte::margin_note()
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic_2()
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic()
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic(font_size=12)
totals_by_type() %>% dplyr::filter(country=="Russia") %>% kableExtra::kbl(caption="Russia: Totals by System Type and Status") %>% kableExtra::kable_classic(font_size=16)
